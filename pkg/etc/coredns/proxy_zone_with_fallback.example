# CoreDNS Configuration: Local Zone with DNS Proxy Fallback
# 
# This configuration:
# 1. Checks local zone file first for lex4.top records
# 2. If record not found locally, falls through to forward
# 3. Forwards missing records to upstream DNS recursively
# 4. Useful for internal domains + internet DNS resolution
#
# Setup:
# 1. Create zone file:
#    sudo coredns-zone init lex4.top
#    sudo nano /etc/coredns/zone/lex4.top
#
# 2. Add DNS records to zone file (example):
#    @    3600 IN A        192.168.1.1
#    www  3600 IN A        192.168.1.100
#    api  3600 IN AAAA     2001:db8::1
#
# 3. Configure upstream DNS servers (replace 8.8.8.8, 8.8.4.4 with your DNS):
#    - Google: 8.8.8.8 8.8.4.4
#    - Cloudflare: 1.1.1.1 1.0.0.1
#    - Quad9: 9.9.9.9
#
# 4. Reload CoreDNS:
#    sudo systemctl reload coredns

# Root zone - handles all queries
. {
    # Detect DNS loops
    loop

    # Try to match local zone file for lex4.top
    # Use fallthrough to also forward unmatched queries
    file /etc/coredns/zone/lex4.top lex4.top {
        fallthrough
    }

    # Forward all queries (including lex4.top misses) to upstream DNS
    forward . 8.8.8.8 8.8.4.4

    # Enable caching for performance
    cache 120

    # Show errors
    errors
}
